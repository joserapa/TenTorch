
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>MPS - MNIST Binarized &#8212; TensorKrowch 00.00.01 documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../_static/tensorkrowch_favicon_light.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Reference" href="../api.html" />
    <link rel="prev" title="MPS with DMRG - MNIST" href="miles_mps_dmrg_mnist.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/tensorkrowch_logo_light.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contents:
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../tutorials.html">
   Tutorials
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/basics.html">
     Basics
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../examples.html">
   Experiments
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="jose_mps_mnist.html">
     MPS and Canonical Form - MNIST
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="jose_mps_canonical_mnist.html">
     MPS and Canonical Form initializing also in canonical form - MNIST
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="jose_mps_fashion_mnist.html">
     MPS and Canonical Form - FashionMNIST
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="cirac_snake_sbs_fashion_mnist.html">
     SnakeSBS - FashionMNIST
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="cirac_cnn_snake_sbs_fashion_mnist.html">
     CNN-SnakeSBS - FashionMNIST
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="jose_convmps_fashion_mnist.html">
     ConvMPS - FashionMNIST
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="jose_convtree_fashion_mnist.html">
     ConvTree - FashionMNIST
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="miles_mps_dmrg_mnist.html">
     MPS with DMRG - MNIST
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     MPS - MNIST Binarized
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../api.html">
   API Reference
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../components.html">
     Components
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../initializers.html">
     Initializers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../embeddings.html">
     Embeddings
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../operations.html">
     Operations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../models.html">
     Models
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>
<a href="https://github.com/joserapa98/tensorkrowch"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="bottom"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/examples/jose_mps_mnist_binarized.ipynb.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>MPS - MNIST Binarized</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="MPS---MNIST-Binarized">
<h1>MPS - MNIST Binarized<a class="headerlink" href="#MPS---MNIST-Binarized" title="Permalink to this headline">#</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">from</span> <span class="nn">torchvision</span> <span class="kn">import</span> <span class="n">transforms</span><span class="p">,</span> <span class="n">datasets</span>

<span class="kn">import</span> <span class="nn">tensorkrowch</span> <span class="k">as</span> <span class="nn">tk</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Miscellaneous initialization</span>
<span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Training parameters</span>
<span class="n">num_train</span> <span class="o">=</span> <span class="mi">60000</span>
<span class="n">num_test</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">image_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>
<span class="n">num_epochs</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">num_epochs_canonical</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">learn_rate</span> <span class="o">=</span> <span class="mf">1e-4</span>
<span class="n">l2_reg</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">d_phys</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">d_bond</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cuda&#39;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;cpu&#39;</span><span class="p">)</span>

<span class="n">mps</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">MPSLayer</span><span class="p">(</span><span class="n">n_sites</span><span class="o">=</span><span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                  <span class="n">d_phys</span><span class="o">=</span><span class="n">d_phys</span><span class="p">,</span>
                  <span class="n">n_labels</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                  <span class="n">d_bond</span><span class="o">=</span><span class="n">d_bond</span><span class="p">)</span>
<span class="n">mps</span> <span class="o">=</span> <span class="n">mps</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

<span class="c1"># for node in mps.leaf_nodes.values():</span>
<span class="c1">#     node.tensor = math.sqrt(2) * node.tensor</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Before starting training, set memory modes to True, and trace</span>
<span class="n">mps</span><span class="o">.</span><span class="n">auto_stack</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">mps</span><span class="o">.</span><span class="n">auto_unbind</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">mps</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">d_phys</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set our loss function and optimizer</span>
<span class="n">loss_fun</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">mps</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span>
                             <span class="n">lr</span><span class="o">=</span><span class="n">learn_rate</span><span class="p">,</span>
                             <span class="n">weight_decay</span><span class="o">=</span><span class="n">l2_reg</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">embedding</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
    <span class="c1"># return (1 / math.sqrt(2)) * torch.stack(</span>
    <span class="c1">#     [torch.ones_like(image), image], dim=1)</span>
    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="n">image</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">([</span><span class="n">transforms</span><span class="o">.</span><span class="n">Resize</span><span class="p">(</span><span class="n">image_size</span><span class="p">),</span>
                                <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(),</span>
                                <span class="n">transforms</span><span class="o">.</span><span class="n">Normalize</span><span class="p">((</span><span class="mf">0.1307</span><span class="p">,),</span> <span class="p">(</span><span class="mf">0.3081</span><span class="p">,)),</span>
                                <span class="n">transforms</span><span class="o">.</span><span class="n">Lambda</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
                                <span class="n">transforms</span><span class="o">.</span><span class="n">Lambda</span><span class="p">(</span><span class="n">embedding</span><span class="p">)])</span>

<span class="n">train_set</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">MNIST</span><span class="p">(</span><span class="s1">&#39;./data&#39;</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">)</span>
<span class="n">test_set</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">MNIST</span><span class="p">(</span><span class="s1">&#39;./data&#39;</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span>
                          <span class="n">train</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Put MNIST data into dataloaders</span>
<span class="n">samplers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">SubsetRandomSampler</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_train</span><span class="p">)),</span>
    <span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">SubsetRandomSampler</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_test</span><span class="p">)),</span>
<span class="p">}</span>
<span class="n">loaders</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span>
        <span class="n">dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">samplers</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">drop_last</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[(</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">train_set</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">test_set</span><span class="p">)]</span>
<span class="p">}</span>
<span class="n">num_batches</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">total_num</span> <span class="o">//</span> <span class="n">batch_size</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">total_num</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[(</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">num_train</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">num_test</span><span class="p">)]</span>
<span class="p">}</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Training on </span><span class="si">{</span><span class="n">num_train</span><span class="si">}</span><span class="s2"> MNIST images </span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;(testing on </span><span class="si">{</span><span class="n">num_test</span><span class="si">}</span><span class="s2">) for </span><span class="si">{</span><span class="n">num_epochs</span><span class="si">}</span><span class="s2"> epochs&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using Adam w/ learning rate = </span><span class="si">{</span><span class="n">learn_rate</span><span class="si">:</span><span class="s2">.1e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">l2_reg</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; * L2 regularization = </span><span class="si">{</span><span class="n">l2_reg</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Training on 60000 MNIST images
(testing on 10000) for 10 epochs
Using Adam w/ learning rate = 1.0e-04

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">epoch_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_epochs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">running_train_loss</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">running_train_acc</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">for</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span> <span class="ow">in</span> <span class="n">loaders</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]:</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">view</span><span class="p">(</span>
            <span class="p">[</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">d_phys</span><span class="p">,</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">data</span>
        <span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="n">labels</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

        <span class="n">scores</span> <span class="o">=</span> <span class="n">mps</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">preds</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Compute the loss and accuracy, add them to the running totals</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_fun</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="n">accuracy</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">preds</span> <span class="o">==</span> <span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">/</span> <span class="n">batch_size</span>
            <span class="n">running_train_loss</span> <span class="o">+=</span> <span class="n">loss</span>
            <span class="n">running_train_acc</span> <span class="o">+=</span> <span class="n">accuracy</span>

        <span class="c1"># Backpropagate and update parameters</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
        <span class="n">running_test_acc</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">for</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span> <span class="ow">in</span> <span class="n">loaders</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">]:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">view</span><span class="p">([</span>
                <span class="n">batch_size</span><span class="p">,</span> <span class="n">d_phys</span><span class="p">,</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">data</span>
            <span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="n">labels</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

            <span class="c1"># Call our MPS to get logit scores and predictions</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="n">mps</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">preds</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">running_test_acc</span> <span class="o">+=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">preds</span> <span class="o">==</span> <span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">/</span> <span class="n">batch_size</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;* Epoch </span><span class="si">{</span><span class="n">epoch_num</span><span class="si">}</span><span class="s1">: &#39;</span>
          <span class="sa">f</span><span class="s1">&#39;Train. Loss: </span><span class="si">{</span><span class="n">running_train_loss</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">num_batches</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">, &#39;</span>
          <span class="sa">f</span><span class="s1">&#39;Train. Acc.: </span><span class="si">{</span><span class="n">running_train_acc</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">num_batches</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">, &#39;</span>
          <span class="sa">f</span><span class="s1">&#39;Test Acc.: </span><span class="si">{</span><span class="n">running_test_acc</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">num_batches</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
* Epoch 1: Train. Loss: 0.9356, Train. Acc.: 0.6729, Test Acc.: 0.9050
* Epoch 2: Train. Loss: 0.2356, Train. Acc.: 0.9273, Test Acc.: 0.9510
* Epoch 3: Train. Loss: 0.1526, Train. Acc.: 0.9532, Test Acc.: 0.9625
* Epoch 4: Train. Loss: 0.1149, Train. Acc.: 0.9644, Test Acc.: 0.9655
* Epoch 5: Train. Loss: 0.0938, Train. Acc.: 0.9706, Test Acc.: 0.9700
* Epoch 6: Train. Loss: 0.0786, Train. Acc.: 0.9762, Test Acc.: 0.9724
* Epoch 7: Train. Loss: 0.0693, Train. Acc.: 0.9781, Test Acc.: 0.9733
* Epoch 8: Train. Loss: 0.0609, Train. Acc.: 0.9803, Test Acc.: 0.9758
* Epoch 9: Train. Loss: 0.0544, Train. Acc.: 0.9822, Test Acc.: 0.9752
* Epoch 10: Train. Loss: 0.0505, Train. Acc.: 0.9839, Test Acc.: 0.9769
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Original number of parametrs</span>
<span class="n">n_params</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">memory</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">mps</span><span class="o">.</span><span class="n">parameters</span><span class="p">():</span>
    <span class="n">n_params</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">nelement</span><span class="p">()</span>
    <span class="n">memory</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">nelement</span><span class="p">()</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">element_size</span><span class="p">()</span>  <span class="c1"># Bytes</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Nº params:     </span><span class="si">{</span><span class="n">n_params</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Memory module: </span><span class="si">{</span><span class="n">memory</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1024</span><span class="o">**</span><span class="mi">2</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1"> MB&#39;</span><span class="p">)</span>  <span class="c1"># MegaBytes</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Nº params:     157440
Memory module: 0.6006 MB
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Save model</span>

<span class="n">mps</span><span class="o">.</span><span class="n">canonicalize</span><span class="p">(</span><span class="n">cum_percentage</span><span class="o">=</span><span class="mf">0.98</span><span class="p">)</span>

<span class="n">save_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;state_dict&#39;</span><span class="p">:</span> <span class="n">mps</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span>
             <span class="s1">&#39;d_bond&#39;</span><span class="p">:</span> <span class="n">mps</span><span class="o">.</span><span class="n">d_bond</span><span class="p">}</span>
<span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">save_dict</span><span class="p">,</span> <span class="s1">&#39;mps.pt&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load model</span>

<span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cuda&#39;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;cpu&#39;</span><span class="p">)</span>

<span class="n">load_dict</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;mps.pt&#39;</span><span class="p">)</span>

<span class="n">mps_lst</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">mps</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">MPSLayer</span><span class="p">(</span><span class="n">n_sites</span><span class="o">=</span><span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                      <span class="n">d_phys</span><span class="o">=</span><span class="n">d_phys</span><span class="p">,</span>
                      <span class="n">n_labels</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                      <span class="n">d_bond</span><span class="o">=</span><span class="n">load_dict</span><span class="p">[</span><span class="s1">&#39;d_bond&#39;</span><span class="p">])</span>
    <span class="n">mps</span> <span class="o">=</span> <span class="n">mps</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="n">mps</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">load_dict</span><span class="p">[</span><span class="s1">&#39;state_dict&#39;</span><span class="p">])</span>

    <span class="n">mps_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mps</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">generated_class</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">v_class_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="n">v_class_tensor</span><span class="p">[</span><span class="n">generated_class</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>

<span class="n">v1_class</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;v1_class&#39;</span><span class="p">,</span>
                   <span class="n">axes_names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,),</span>
                   <span class="n">tensor</span><span class="o">=</span><span class="n">v_class_tensor</span><span class="p">)</span>
<span class="n">v2_class</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;v2_class&#39;</span><span class="p">,</span>
                   <span class="n">axes_names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,),</span>
                   <span class="n">tensor</span><span class="o">=</span><span class="n">v_class_tensor</span><span class="p">)</span>

<span class="n">pixel_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="n">v1</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;v1&#39;</span><span class="p">,</span>
             <span class="n">axes_names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;feature&#39;</span><span class="p">,),</span>
             <span class="n">tensor</span><span class="o">=</span><span class="n">pixel_tensor</span><span class="p">)</span>
<span class="n">v2</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;v2&#39;</span><span class="p">,</span>
             <span class="n">axes_names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;feature&#39;</span><span class="p">,),</span>
             <span class="n">tensor</span><span class="o">=</span><span class="n">pixel_tensor</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute norm</span>
<span class="n">mps_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">output_node</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span> <span class="o">^</span> <span class="n">v1_class</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span>
<span class="n">mps_lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">output_node</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span> <span class="o">^</span> <span class="n">v2_class</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">mps_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">output_node</span> <span class="o">@</span> <span class="n">v1_class</span>

<span class="n">norm</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">tensor</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">norm</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
tensor(21.9669, device=&#39;cuda:0&#39;, grad_fn=&lt;CopyBackwards&gt;)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nodes_mps_lst</span> <span class="o">=</span> <span class="p">[([</span><span class="n">mps_lst</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">left_node</span><span class="p">]</span> <span class="o">+</span> \
                   <span class="n">mps_lst</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">left_env</span> <span class="o">+</span> \
                  <span class="p">[</span><span class="n">mps_lst</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">output_node</span><span class="p">]</span> <span class="o">+</span> \
                   <span class="n">mps_lst</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">right_env</span> <span class="o">+</span> \
                  <span class="p">[</span><span class="n">mps_lst</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">right_node</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">nodes_mps_lst</span><span class="p">)):</span>
    <span class="k">if</span> <span class="s1">&#39;output&#39;</span> <span class="ow">in</span> <span class="n">node1</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">node1</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">]</span> <span class="o">^</span> <span class="n">v1</span><span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span>
            <span class="n">node2</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">]</span> <span class="o">^</span> <span class="n">v2</span><span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">node1</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">]</span> <span class="o">^</span> <span class="n">node2</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate</span>
<span class="n">new_image</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">do_left_env</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">do_right_env</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">do_right_node</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">output</span> <span class="o">=</span> <span class="p">(</span><span class="n">mps_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">output_node</span> <span class="o">@</span> <span class="n">v1_class</span><span class="p">)</span> <span class="o">%</span> \
            <span class="p">(</span><span class="n">mps_lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">output_node</span> <span class="o">@</span> <span class="n">v2_class</span><span class="p">)</span>

<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">new_probability</span> <span class="o">=</span> <span class="p">(</span><span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">@</span> <span class="n">v1</span><span class="p">)</span> <span class="o">%</span> \
                                <span class="p">(</span><span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">@</span> <span class="n">v2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">&#39;output&#39;</span> <span class="ow">in</span> <span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
        <span class="n">fixed_probability</span> <span class="o">@=</span> <span class="n">output</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">continue</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">]</span> <span class="o">^</span> <span class="n">v1</span><span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span>
        <span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">]</span> <span class="o">^</span> <span class="n">v2</span><span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span>

        <span class="n">new_probability</span> <span class="o">=</span> <span class="n">fixed_probability</span> <span class="o">@</span> <span class="p">((</span><span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">@</span> <span class="n">v1</span><span class="p">)</span> <span class="o">%</span> \
                                                <span class="p">(</span><span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">@</span> <span class="n">v2</span><span class="p">))</span>

    <span class="n">left_result_lst</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">right_result_lst</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># left env</span>
    <span class="k">if</span> <span class="n">do_left_env</span><span class="p">:</span>
        <span class="n">stack1</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">][(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):(</span><span class="nb">len</span><span class="p">(</span><span class="n">mps_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">left_env</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
        <span class="n">stack2</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">1</span><span class="p">][(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):(</span><span class="nb">len</span><span class="p">(</span><span class="n">mps_lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">left_env</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
        <span class="n">stack1</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">]</span> <span class="o">^</span> <span class="n">stack2</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">]</span>
        <span class="n">stack_result</span> <span class="o">=</span> <span class="n">stack1</span> <span class="o">@</span> <span class="n">stack2</span>
        <span class="n">left_result_lst</span> <span class="o">+=</span> <span class="n">tk</span><span class="o">.</span><span class="n">unbind</span><span class="p">(</span><span class="n">stack_result</span><span class="p">)</span>

    <span class="c1"># right env</span>
    <span class="k">if</span> <span class="n">do_right_env</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">mps_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">left_env</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">stack1</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">j</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">stack2</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">stack1</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">]</span> <span class="o">^</span> <span class="n">stack2</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">]</span>
        <span class="n">stack_result</span> <span class="o">=</span> <span class="n">stack1</span> <span class="o">@</span> <span class="n">stack2</span>
        <span class="n">right_result_lst</span> <span class="o">+=</span> <span class="n">tk</span><span class="o">.</span><span class="n">unbind</span><span class="p">(</span><span class="n">stack_result</span><span class="p">)</span>

    <span class="c1"># right node</span>
    <span class="k">if</span> <span class="n">do_right_node</span><span class="p">:</span>
        <span class="n">right_result_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">@</span> <span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># Contract matrices</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">new_probability</span>

    <span class="k">if</span> <span class="n">do_left_env</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">left_result_lst</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">@=</span> <span class="n">node</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">mps_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">left_env</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">do_left_env</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mps_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">left_env</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">@=</span> <span class="n">output</span>

    <span class="k">if</span> <span class="n">do_right_env</span> <span class="ow">or</span> <span class="n">do_right_node</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">right_result_lst</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">@=</span> <span class="n">node</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">do_right_env</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">do_right_node</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># print(&#39;Result:&#39;, result.tensor.item())</span>

    <span class="n">prob</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">tensor</span> <span class="o">/</span> <span class="n">norm</span><span class="o">**</span><span class="mi">2</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Probability of pixel </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">prob</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">prob</span><span class="o">.</span><span class="n">item</span><span class="p">():</span>
        <span class="n">v1_copy</span> <span class="o">=</span> <span class="n">v1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">v1_copy</span><span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="n">v1_copy</span><span class="o">.</span><span class="n">tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

        <span class="n">v2_copy</span> <span class="o">=</span> <span class="n">v2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">v2_copy</span><span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="n">v2_copy</span><span class="o">.</span><span class="n">tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

        <span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">]</span> <span class="o">^</span> <span class="n">v1_copy</span><span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span>
        <span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">]</span> <span class="o">^</span> <span class="n">v2_copy</span><span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span>

        <span class="n">new_image</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">v1_copy</span> <span class="o">=</span> <span class="n">v1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">v1_copy</span><span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

        <span class="n">v2_copy</span> <span class="o">=</span> <span class="n">v2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">v2_copy</span><span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

        <span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">]</span> <span class="o">^</span> <span class="n">v1_copy</span><span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span>
        <span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">]</span> <span class="o">^</span> <span class="n">v2_copy</span><span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span>

        <span class="n">new_image</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">fixed_probability</span> <span class="o">=</span> <span class="p">(</span><span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">@</span> <span class="n">v1_copy</span><span class="p">)</span> <span class="o">%</span> \
                                <span class="p">(</span><span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">@</span> <span class="n">v2_copy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fixed_probability</span> <span class="o">@=</span> <span class="p">(</span><span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">@</span> <span class="n">v1_copy</span><span class="p">)</span> <span class="o">%</span> \
                                <span class="p">(</span><span class="n">nodes_mps_lst</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">@</span> <span class="n">v2_copy</span><span class="p">)</span>

    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Probability of pixel 0: 0.9970
Probability of pixel 1: 0.9937
Probability of pixel 2: 0.9903
Probability of pixel 3: 0.9868
Probability of pixel 4: 0.9832
Probability of pixel 5: 0.9796
Probability of pixel 6: 0.9759
Probability of pixel 7: 0.9722
Probability of pixel 8: 0.9683
Probability of pixel 9: 0.9644
Probability of pixel 10: 0.9604
Probability of pixel 11: 0.9564
Probability of pixel 12: 0.9523
Probability of pixel 13: 0.9481
Probability of pixel 14: 0.9438
Probability of pixel 15: 0.9394
Probability of pixel 16: 0.9350
Probability of pixel 17: 0.9305
Probability of pixel 18: 0.9258
Probability of pixel 19: 0.9211
Probability of pixel 20: 0.9163
Probability of pixel 21: 0.9115
Probability of pixel 22: 0.9162
Probability of pixel 23: 0.9111
Probability of pixel 24: 0.9059
Probability of pixel 25: 0.9007
Probability of pixel 26: 0.8953
Probability of pixel 27: 0.8899
Probability of pixel 28: 0.8844
Probability of pixel 29: 0.8787
Probability of pixel 30: 0.8730
Probability of pixel 31: 0.8673
Probability of pixel 32: 0.8614
Probability of pixel 33: 0.8671
Probability of pixel 34: 0.8731
Probability of pixel 35: 0.8791
Probability of pixel 36: 0.8727
Probability of pixel 37: 0.8663
Probability of pixel 38: 0.8601
Probability of pixel 39: 0.8538
Probability of pixel 40: 0.8477
Probability of pixel 41: 0.8416
Probability of pixel 42: 0.8353
Probability of pixel 43: 0.8289
Probability of pixel 44: 0.8224
Probability of pixel 45: 0.8156
Probability of pixel 46: 0.8088
Probability of pixel 47: 0.8018
Probability of pixel 48: 0.7946
Probability of pixel 49: 0.7872
Probability of pixel 50: 0.7795
Probability of pixel 51: 0.7717
Probability of pixel 52: 0.7792
Probability of pixel 53: 0.7871
Probability of pixel 54: 0.7952
Probability of pixel 55: 0.8035
Probability of pixel 56: 0.7946
Probability of pixel 57: 0.7856
Probability of pixel 58: 0.7765
Probability of pixel 59: 0.7674
Probability of pixel 60: 0.7583
Probability of pixel 61: 0.7492
Probability of pixel 62: 0.7404
Probability of pixel 63: 0.7325
Probability of pixel 64: 0.7251
Probability of pixel 65: 0.7323
Probability of pixel 66: 0.7262
Probability of pixel 67: 0.7343
Probability of pixel 68: 0.7313
Probability of pixel 69: 0.7346
Probability of pixel 70: 0.7307
Probability of pixel 71: 0.7299
Probability of pixel 72: 0.7288
Probability of pixel 73: 0.7273
Probability of pixel 74: 0.7217
Probability of pixel 75: 0.7265
Probability of pixel 76: 0.7178
Probability of pixel 77: 0.7105
Probability of pixel 78: 0.7022
Probability of pixel 79: 0.7082
Probability of pixel 80: 0.7175
Probability of pixel 81: 0.7052
Probability of pixel 82: 0.6928
Probability of pixel 83: 0.6804
Probability of pixel 84: 0.6924
Probability of pixel 85: 0.7047
Probability of pixel 86: 0.6916
Probability of pixel 87: 0.6784
Probability of pixel 88: 0.6640
Probability of pixel 89: 0.6798
Probability of pixel 90: 0.6683
Probability of pixel 91: 0.6578
Probability of pixel 92: 0.6459
Probability of pixel 93: 0.6597
Probability of pixel 94: 0.6717
Probability of pixel 95: 0.6627
Probability of pixel 96: 0.6525
Probability of pixel 97: 0.6370
Probability of pixel 98: 0.6579
Probability of pixel 99: 0.6574
Probability of pixel 100: 0.6497
Probability of pixel 101: 0.6407
Probability of pixel 102: 0.6363
Probability of pixel 103: 0.6237
Probability of pixel 104: 0.6380
Probability of pixel 105: 0.6414
Probability of pixel 106: 0.6337
Probability of pixel 107: 0.6239
Probability of pixel 108: 0.6132
Probability of pixel 109: 0.5999
Probability of pixel 110: 0.6121
Probability of pixel 111: 0.6277
Probability of pixel 112: 0.6145
Probability of pixel 113: 0.6272
Probability of pixel 114: 0.6136
Probability of pixel 115: 0.6270
Probability of pixel 116: 0.6139
Probability of pixel 117: 0.6023
Probability of pixel 118: 0.6159
Probability of pixel 119: 0.6088
Probability of pixel 120: 0.6208
Probability of pixel 121: 0.6284
Probability of pixel 122: 0.6267
Probability of pixel 123: 0.6282
Probability of pixel 124: 0.6381
Probability of pixel 125: 0.6350
Probability of pixel 126: 0.6263
Probability of pixel 127: 0.6381
Probability of pixel 128: 0.6545
Probability of pixel 129: 0.6437
Probability of pixel 130: 0.6475
Probability of pixel 131: 0.6485
Probability of pixel 132: 0.6371
Probability of pixel 133: 0.6234
Probability of pixel 134: 0.6411
Probability of pixel 135: 0.6431
Probability of pixel 136: 0.6264
Probability of pixel 137: 0.6110
Probability of pixel 138: 0.6294
Probability of pixel 139: 0.6168
Probability of pixel 140: 0.6049
Probability of pixel 141: 0.5929
Probability of pixel 142: 0.5809
Probability of pixel 143: 0.5905
Probability of pixel 144: 0.6077
Probability of pixel 145: 0.6210
Probability of pixel 146: 0.6136
Probability of pixel 147: 0.6271
Probability of pixel 148: 0.6302
Probability of pixel 149: 0.6250
Probability of pixel 150: 0.6345
Probability of pixel 151: 0.6247
Probability of pixel 152: 0.6395
Probability of pixel 153: 0.6232
Probability of pixel 154: 0.6525
Probability of pixel 155: 0.6612
Probability of pixel 156: 0.6511
Probability of pixel 157: 0.6781
Probability of pixel 158: 0.6834
Probability of pixel 159: 0.7015
Probability of pixel 160: 0.7060
Probability of pixel 161: 0.7148
Probability of pixel 162: 0.7027
Probability of pixel 163: 0.6866
Probability of pixel 164: 0.6919
Probability of pixel 165: 0.6894
Probability of pixel 166: 0.6787
Probability of pixel 167: 0.6686
Probability of pixel 168: 0.6591
Probability of pixel 169: 0.6494
Probability of pixel 170: 0.6399
Probability of pixel 171: 0.6293
Probability of pixel 172: 0.6444
Probability of pixel 173: 0.6381
Probability of pixel 174: 0.6400
Probability of pixel 175: 0.6417
Probability of pixel 176: 0.6440
Probability of pixel 177: 0.6463
Probability of pixel 178: 0.6595
Probability of pixel 179: 0.6640
Probability of pixel 180: 0.6476
Probability of pixel 181: 0.6281
Probability of pixel 182: 0.5765
Probability of pixel 183: 0.6197
Probability of pixel 184: 0.5795
Probability of pixel 185: 0.6361
Probability of pixel 186: 0.6214
Probability of pixel 187: 0.6610
Probability of pixel 188: 0.6481
Probability of pixel 189: 0.6735
Probability of pixel 190: 0.6937
Probability of pixel 191: 0.7115
Probability of pixel 192: 0.7171
Probability of pixel 193: 0.7020
Probability of pixel 194: 0.6968
Probability of pixel 195: 0.7011
Probability of pixel 196: 0.6951
Probability of pixel 197: 0.6891
Probability of pixel 198: 0.6954
Probability of pixel 199: 0.7002
Probability of pixel 200: 0.7109
Probability of pixel 201: 0.7139
Probability of pixel 202: 0.7126
Probability of pixel 203: 0.7240
Probability of pixel 204: 0.7087
Probability of pixel 205: 0.7206
Probability of pixel 206: 0.7277
Probability of pixel 207: 0.7104
Probability of pixel 208: 0.7231
Probability of pixel 209: 0.7267
Probability of pixel 210: 0.7595
Probability of pixel 211: 0.7106
Probability of pixel 212: 0.6857
Probability of pixel 213: 0.6870
Probability of pixel 214: 0.6997
Probability of pixel 215: 0.6927
Probability of pixel 216: 0.6642
Probability of pixel 217: 0.6448
Probability of pixel 218: 0.6551
Probability of pixel 219: 0.6657
Probability of pixel 220: 0.6710
Probability of pixel 221: 0.6652
Probability of pixel 222: 0.6609
Probability of pixel 223: 0.6541
Probability of pixel 224: 0.6607
Probability of pixel 225: 0.6544
Probability of pixel 226: 0.6477
Probability of pixel 227: 0.6547
Probability of pixel 228: 0.6519
Probability of pixel 229: 0.6531
Probability of pixel 230: 0.6614
Probability of pixel 231: 0.6425
Probability of pixel 232: 0.6345
Probability of pixel 233: 0.6373
Probability of pixel 234: 0.6312
Probability of pixel 235: 0.6254
Probability of pixel 236: 0.6114
Probability of pixel 237: 0.5914
Probability of pixel 238: 0.5716
Probability of pixel 239: 0.6020
Probability of pixel 240: 0.6171
Probability of pixel 241: 0.6226
Probability of pixel 242: 0.6209
Probability of pixel 243: 0.6312
Probability of pixel 244: 0.6364
Probability of pixel 245: 0.6376
Probability of pixel 246: 0.6491
Probability of pixel 247: 0.6281
Probability of pixel 248: 0.6229
Probability of pixel 249: 0.6162
Probability of pixel 250: 0.6103
Probability of pixel 251: 0.6028
Probability of pixel 252: 0.6102
Probability of pixel 253: 0.6178
Probability of pixel 254: 0.6107
Probability of pixel 255: 0.6185
Probability of pixel 256: 0.6237
Probability of pixel 257: 0.6197
Probability of pixel 258: 0.6266
Probability of pixel 259: 0.6226
Probability of pixel 260: 0.6278
Probability of pixel 261: 0.6161
Probability of pixel 262: 0.5988
Probability of pixel 263: 0.5966
Probability of pixel 264: 0.5984
Probability of pixel 265: 0.6099
Probability of pixel 266: 0.5937
Probability of pixel 267: 0.5937
Probability of pixel 268: 0.6094
Probability of pixel 269: 0.6246
Probability of pixel 270: 0.6342
Probability of pixel 271: 0.6388
Probability of pixel 272: 0.5985
Probability of pixel 273: 0.6127
Probability of pixel 274: 0.5949
Probability of pixel 275: 0.5976
Probability of pixel 276: 0.5926
Probability of pixel 277: 0.5876
Probability of pixel 278: 0.5814
Probability of pixel 279: 0.5875
Probability of pixel 280: 0.5937
Probability of pixel 281: 0.5998
Probability of pixel 282: 0.5933
Probability of pixel 283: 0.6009
Probability of pixel 284: 0.6013
Probability of pixel 285: 0.5940
Probability of pixel 286: 0.5883
Probability of pixel 287: 0.5765
Probability of pixel 288: 0.5938
Probability of pixel 289: 0.5959
Probability of pixel 290: 0.5997
Probability of pixel 291: 0.6122
Probability of pixel 292: 0.6400
Probability of pixel 293: 0.6500
Probability of pixel 294: 0.6455
Probability of pixel 295: 0.6382
Probability of pixel 296: 0.6354
Probability of pixel 297: 0.6396
Probability of pixel 298: 0.6536
Probability of pixel 299: 0.6401
Probability of pixel 300: 0.6225
Probability of pixel 301: 0.6117
Probability of pixel 302: 0.6137
Probability of pixel 303: 0.6109
Probability of pixel 304: 0.6104
Probability of pixel 305: 0.6146
Probability of pixel 306: 0.6094
Probability of pixel 307: 0.6051
Probability of pixel 308: 0.6010
Probability of pixel 309: 0.6051
Probability of pixel 310: 0.6000
Probability of pixel 311: 0.5949
Probability of pixel 312: 0.5894
Probability of pixel 313: 0.5833
Probability of pixel 314: 0.5890
Probability of pixel 315: 0.5861
Probability of pixel 316: 0.5945
Probability of pixel 317: 0.5960
Probability of pixel 318: 0.6025
Probability of pixel 319: 0.5864
Probability of pixel 320: 0.5603
Probability of pixel 321: 0.5138
Probability of pixel 322: 0.4958
Probability of pixel 323: 0.5216
Probability of pixel 324: 0.5085
Probability of pixel 325: 0.5048
Probability of pixel 326: 0.5069
Probability of pixel 327: 0.5173
Probability of pixel 328: 0.5091
Probability of pixel 329: 0.5057
Probability of pixel 330: 0.5064
Probability of pixel 331: 0.5100
Probability of pixel 332: 0.5026
Probability of pixel 333: 0.4961
Probability of pixel 334: 0.4933
Probability of pixel 335: 0.4963
Probability of pixel 336: 0.4937
Probability of pixel 337: 0.4964
Probability of pixel 338: 0.4937
Probability of pixel 339: 0.4907
Probability of pixel 340: 0.4907
Probability of pixel 341: 0.5065
Probability of pixel 342: 0.4932
Probability of pixel 343: 0.5055
Probability of pixel 344: 0.5097
Probability of pixel 345: 0.5000
Probability of pixel 346: 0.5163
Probability of pixel 347: 0.5006
Probability of pixel 348: 0.4904
Probability of pixel 349: 0.4954
Probability of pixel 350: 0.4778
Probability of pixel 351: 0.5036
Probability of pixel 352: 0.5016
Probability of pixel 353: 0.5028
Probability of pixel 354: 0.5030
Probability of pixel 355: 0.5064
Probability of pixel 356: 0.4981
Probability of pixel 357: 0.4996
Probability of pixel 358: 0.5000
Probability of pixel 359: 0.4840
Probability of pixel 360: 0.4977
Probability of pixel 361: 0.5010
Probability of pixel 362: 0.5088
Probability of pixel 363: 0.5120
Probability of pixel 364: 0.5097
Probability of pixel 365: 0.5075
Probability of pixel 366: 0.5097
Probability of pixel 367: 0.5116
Probability of pixel 368: 0.5125
Probability of pixel 369: 0.5207
Probability of pixel 370: 0.5014
Probability of pixel 371: 0.5002
Probability of pixel 372: 0.5088
Probability of pixel 373: 0.5032
Probability of pixel 374: 0.5173
Probability of pixel 375: 0.5114
Probability of pixel 376: 0.5333
Probability of pixel 377: 0.4830
Probability of pixel 378: 0.4704
Probability of pixel 379: 0.4856
Probability of pixel 380: 0.4908
Probability of pixel 381: 0.4818
Probability of pixel 382: 0.4931
Probability of pixel 383: 0.4895
Probability of pixel 384: 0.4971
Probability of pixel 385: 0.4975
Probability of pixel 386: 0.5006
Probability of pixel 387: 0.4888
Probability of pixel 388: 0.4831
Probability of pixel 389: 0.4801
Probability of pixel 390: 0.4843
Probability of pixel 391: 0.4875
Probability of pixel 393: 0.4896
Probability of pixel 394: 0.4872
Probability of pixel 395: 0.4892
Probability of pixel 396: 0.4903
Probability of pixel 397: 0.4871
Probability of pixel 398: 0.4902
Probability of pixel 399: 0.4887
Probability of pixel 400: 0.4865
Probability of pixel 401: 0.4798
Probability of pixel 402: 0.4797
Probability of pixel 403: 0.4859
Probability of pixel 404: 0.4862
Probability of pixel 405: 0.4946
Probability of pixel 406: 0.4941
Probability of pixel 407: 0.4871
Probability of pixel 408: 0.4817
Probability of pixel 409: 0.4951
Probability of pixel 410: 0.5051
Probability of pixel 411: 0.5012
Probability of pixel 412: 0.4803
Probability of pixel 413: 0.4683
Probability of pixel 414: 0.4606
Probability of pixel 415: 0.4703
Probability of pixel 416: 0.4714
Probability of pixel 417: 0.4706
Probability of pixel 418: 0.4728
Probability of pixel 419: 0.4718
Probability of pixel 420: 0.4729
Probability of pixel 421: 0.4723
Probability of pixel 422: 0.4715
Probability of pixel 423: 0.4705
Probability of pixel 424: 0.4693
Probability of pixel 425: 0.4719
Probability of pixel 426: 0.4721
Probability of pixel 427: 0.4804
Probability of pixel 428: 0.4932
Probability of pixel 429: 0.4844
Probability of pixel 430: 0.4985
Probability of pixel 431: 0.4718
Probability of pixel 432: 0.4666
Probability of pixel 433: 0.4577
Probability of pixel 434: 0.4695
Probability of pixel 435: 0.4569
Probability of pixel 436: 0.4484
Probability of pixel 437: 0.4378
Probability of pixel 438: 0.4549
Probability of pixel 439: 0.4594
Probability of pixel 440: 0.4575
Probability of pixel 441: 0.4619
Probability of pixel 442: 0.4525
Probability of pixel 443: 0.4606
Probability of pixel 444: 0.4481
Probability of pixel 445: 0.4499
Probability of pixel 446: 0.4496
Probability of pixel 447: 0.4459
Probability of pixel 448: 0.4429
Probability of pixel 449: 0.4465
Probability of pixel 450: 0.4439
Probability of pixel 451: 0.4467
Probability of pixel 452: 0.4427
Probability of pixel 453: 0.4429
Probability of pixel 454: 0.4447
Probability of pixel 455: 0.4500
Probability of pixel 456: 0.4505
Probability of pixel 457: 0.4733
Probability of pixel 458: 0.4835
Probability of pixel 459: 0.4909
Probability of pixel 460: 0.4813
Probability of pixel 461: 0.4815
Probability of pixel 462: 0.4734
Probability of pixel 463: 0.4625
Probability of pixel 464: 0.4717
Probability of pixel 465: 0.4784
Probability of pixel 466: 0.5046
Probability of pixel 467: 0.5122
Probability of pixel 468: 0.5447
Probability of pixel 469: 0.5489
Probability of pixel 470: 0.5429
Probability of pixel 471: 0.5507
Probability of pixel 472: 0.5405
Probability of pixel 473: 0.5416
Probability of pixel 474: 0.5366
Probability of pixel 475: 0.5370
Probability of pixel 476: 0.5323
Probability of pixel 477: 0.5377
Probability of pixel 478: 0.5337
Probability of pixel 479: 0.5375
Probability of pixel 480: 0.5415
Probability of pixel 481: 0.5497
Probability of pixel 482: 0.5474
Probability of pixel 483: 0.5510
Probability of pixel 484: 0.5709
Probability of pixel 485: 0.5454
Probability of pixel 486: 0.5573
Probability of pixel 487: 0.5421
Probability of pixel 488: 0.5310
Probability of pixel 489: 0.5309
Probability of pixel 490: 0.5068
Probability of pixel 491: 0.5307
Probability of pixel 492: 0.5635
Probability of pixel 493: 0.5662
Probability of pixel 494: 0.5654
Probability of pixel 495: 0.5635
Probability of pixel 496: 0.5726
Probability of pixel 497: 0.5823
Probability of pixel 498: 0.5887
Probability of pixel 499: 0.5911
Probability of pixel 500: 0.5905
Probability of pixel 501: 0.5832
Probability of pixel 502: 0.5748
Probability of pixel 503: 0.5848
Probability of pixel 504: 0.5922
Probability of pixel 505: 0.5985
Probability of pixel 506: 0.6046
Probability of pixel 507: 0.6103
Probability of pixel 508: 0.6182
Probability of pixel 509: 0.6093
Probability of pixel 510: 0.6097
Probability of pixel 511: 0.6153
Probability of pixel 512: 0.6211
Probability of pixel 513: 0.6493
Probability of pixel 514: 0.6606
Probability of pixel 515: 0.6633
Probability of pixel 516: 0.6327
Probability of pixel 517: 0.6576
Probability of pixel 518: 0.6845
Probability of pixel 519: 0.6615
Probability of pixel 520: 0.6802
Probability of pixel 521: 0.7361
Probability of pixel 522: 0.7370
Probability of pixel 523: 0.7456
Probability of pixel 524: 0.7286
Probability of pixel 525: 0.7350
Probability of pixel 526: 0.7382
Probability of pixel 527: 0.7369
Probability of pixel 528: 0.7291
Probability of pixel 529: 0.7219
Probability of pixel 530: 0.7291
Probability of pixel 531: 0.7214
Probability of pixel 532: 0.7140
Probability of pixel 533: 0.7069
Probability of pixel 534: 0.7141
Probability of pixel 535: 0.7081
Probability of pixel 536: 0.7174
Probability of pixel 537: 0.7191
Probability of pixel 538: 0.7134
Probability of pixel 539: 0.7181
Probability of pixel 540: 0.7145
Probability of pixel 541: 0.7203
Probability of pixel 542: 0.7123
Probability of pixel 543: 0.6713
Probability of pixel 544: 0.6457
Probability of pixel 545: 0.6341
Probability of pixel 546: 0.6064
Probability of pixel 547: 0.5789
Probability of pixel 548: 0.5640
Probability of pixel 549: 0.5901
Probability of pixel 550: 0.6044
Probability of pixel 551: 0.6040
Probability of pixel 552: 0.6041
Probability of pixel 553: 0.6162
Probability of pixel 554: 0.6142
Probability of pixel 555: 0.6175
Probability of pixel 556: 0.6104
Probability of pixel 557: 0.6213
Probability of pixel 558: 0.6163
Probability of pixel 559: 0.6209
Probability of pixel 560: 0.6262
Probability of pixel 561: 0.6317
Probability of pixel 562: 0.6267
Probability of pixel 563: 0.6213
Probability of pixel 564: 0.6193
Probability of pixel 565: 0.6173
Probability of pixel 566: 0.6170
Probability of pixel 567: 0.6061
Probability of pixel 568: 0.6223
Probability of pixel 569: 0.6341
Probability of pixel 570: 0.6604
Probability of pixel 571: 0.6949
Probability of pixel 572: 0.7180
Probability of pixel 573: 0.7294
Probability of pixel 574: 0.7137
Probability of pixel 575: 0.7368
Probability of pixel 576: 0.7308
Probability of pixel 577: 0.7200
Probability of pixel 578: 0.7431
Probability of pixel 579: 0.7513
Probability of pixel 580: 0.7488
Probability of pixel 581: 0.7482
Probability of pixel 582: 0.7468
Probability of pixel 583: 0.7424
Probability of pixel 584: 0.7356
Probability of pixel 585: 0.7276
Probability of pixel 586: 0.7199
Probability of pixel 587: 0.7130
Probability of pixel 588: 0.7062
Probability of pixel 589: 0.6997
Probability of pixel 590: 0.6937
Probability of pixel 591: 0.6997
Probability of pixel 592: 0.6964
Probability of pixel 593: 0.6920
Probability of pixel 594: 0.6958
Probability of pixel 595: 0.6734
Probability of pixel 596: 0.6513
Probability of pixel 597: 0.6461
Probability of pixel 598: 0.6409
Probability of pixel 599: 0.6818
Probability of pixel 600: 0.6371
Probability of pixel 601: 0.6390
Probability of pixel 602: 0.6228
Probability of pixel 603: 0.6102
Probability of pixel 604: 0.6304
Probability of pixel 605: 0.6336
Probability of pixel 606: 0.6383
Probability of pixel 607: 0.6319
Probability of pixel 608: 0.6390
Probability of pixel 609: 0.6428
Probability of pixel 610: 0.6374
Probability of pixel 611: 0.6295
Probability of pixel 612: 0.6236
Probability of pixel 613: 0.6262
Probability of pixel 614: 0.6389
Probability of pixel 615: 0.6332
Probability of pixel 616: 0.6275
Probability of pixel 617: 0.6221
Probability of pixel 618: 0.6171
Probability of pixel 619: 0.6130
Probability of pixel 620: 0.6091
Probability of pixel 621: 0.6088
Probability of pixel 622: 0.6021
Probability of pixel 623: 0.5861
Probability of pixel 624: 0.5765
Probability of pixel 625: 0.5828
Probability of pixel 626: 0.5673
Probability of pixel 627: 0.5664
Probability of pixel 628: 0.5743
Probability of pixel 629: 0.5841
Probability of pixel 630: 0.5796
Probability of pixel 631: 0.5876
Probability of pixel 632: 0.5772
Probability of pixel 633: 0.5857
Probability of pixel 634: 0.5885
Probability of pixel 635: 0.5933
Probability of pixel 636: 0.5745
Probability of pixel 637: 0.5770
Probability of pixel 638: 0.5779
Probability of pixel 639: 0.5783
Probability of pixel 640: 0.5765
Probability of pixel 641: 0.5729
Probability of pixel 642: 0.5798
Probability of pixel 643: 0.5747
Probability of pixel 644: 0.5698
Probability of pixel 645: 0.5748
Probability of pixel 646: 0.5702
Probability of pixel 647: 0.5663
Probability of pixel 648: 0.5633
Probability of pixel 649: 0.5585
Probability of pixel 650: 0.5629
Probability of pixel 651: 0.5716
Probability of pixel 652: 0.5753
Probability of pixel 653: 0.5843
Probability of pixel 654: 0.5830
Probability of pixel 655: 0.5888
Probability of pixel 656: 0.5943
Probability of pixel 657: 0.5706
Probability of pixel 658: 0.5782
Probability of pixel 659: 0.5734
Probability of pixel 660: 0.5726
Probability of pixel 661: 0.5823
Probability of pixel 662: 0.5775
Probability of pixel 663: 0.5898
Probability of pixel 664: 0.5730
Probability of pixel 665: 0.5768
Probability of pixel 666: 0.5787
Probability of pixel 667: 0.5730
Probability of pixel 668: 0.5680
Probability of pixel 669: 0.5604
Probability of pixel 670: 0.5549
Probability of pixel 671: 0.5493
Probability of pixel 672: 0.5443
Probability of pixel 673: 0.5495
Probability of pixel 674: 0.5545
Probability of pixel 675: 0.5501
Probability of pixel 676: 0.5455
Probability of pixel 677: 0.5495
Probability of pixel 678: 0.5419
Probability of pixel 679: 0.5223
Probability of pixel 680: 0.5445
Probability of pixel 681: 0.5690
Probability of pixel 682: 0.5829
Probability of pixel 683: 0.5708
Probability of pixel 684: 0.5918
Probability of pixel 685: 0.5907
Probability of pixel 686: 0.6103
Probability of pixel 687: 0.6021
Probability of pixel 688: 0.5941
Probability of pixel 689: 0.5903
Probability of pixel 690: 0.5882
Probability of pixel 691: 0.5840
Probability of pixel 692: 0.5754
Probability of pixel 693: 0.5896
Probability of pixel 694: 0.5814
Probability of pixel 695: 0.5896
Probability of pixel 696: 0.5786
Probability of pixel 697: 0.5890
Probability of pixel 698: 0.5787
Probability of pixel 699: 0.5891
Probability of pixel 700: 0.5793
Probability of pixel 701: 0.5699
Probability of pixel 702: 0.5608
Probability of pixel 703: 0.5521
Probability of pixel 704: 0.5439
Probability of pixel 705: 0.5300
Probability of pixel 706: 0.5131
Probability of pixel 707: 0.4968
Probability of pixel 708: 0.4791
Probability of pixel 709: 0.4686
Probability of pixel 710: 0.4768
Probability of pixel 711: 0.4590
Probability of pixel 712: 0.4473
Probability of pixel 713: 0.4390
Probability of pixel 714: 0.4538
Probability of pixel 715: 0.4466
Probability of pixel 716: 0.4389
Probability of pixel 717: 0.4519
Probability of pixel 718: 0.4569
Probability of pixel 719: 0.4561
Probability of pixel 720: 0.4563
Probability of pixel 721: 0.4547
Probability of pixel 722: 0.4504
Probability of pixel 723: 0.4451
Probability of pixel 724: 0.4500
Probability of pixel 725: 0.4441
Probability of pixel 726: 0.4507
Probability of pixel 727: 0.4456
Probability of pixel 728: 0.4406
Probability of pixel 729: 0.4358
Probability of pixel 730: 0.4407
Probability of pixel 731: 0.4455
Probability of pixel 732: 0.4503
Probability of pixel 733: 0.4436
Probability of pixel 734: 0.4485
Probability of pixel 735: 0.4415
Probability of pixel 736: 0.4365
Probability of pixel 737: 0.4343
Probability of pixel 738: 0.4314
Probability of pixel 739: 0.4316
Probability of pixel 740: 0.4292
Probability of pixel 741: 0.4287
Probability of pixel 742: 0.4318
Probability of pixel 743: 0.4273
Probability of pixel 744: 0.4246
Probability of pixel 745: 0.4298
Probability of pixel 746: 0.4299
Probability of pixel 747: 0.4293
Probability of pixel 748: 0.4286
Probability of pixel 749: 0.4264
Probability of pixel 750: 0.4244
Probability of pixel 751: 0.4260
Probability of pixel 752: 0.4233
Probability of pixel 753: 0.4204
Probability of pixel 754: 0.4177
Probability of pixel 755: 0.4205
Probability of pixel 756: 0.4178
Probability of pixel 757: 0.4205
Probability of pixel 758: 0.4180
Probability of pixel 759: 0.4155
Probability of pixel 760: 0.4180
Probability of pixel 761: 0.4205
Probability of pixel 762: 0.4182
Probability of pixel 763: 0.4205
Probability of pixel 764: 0.4183
Probability of pixel 765: 0.4206
Probability of pixel 766: 0.4186
Probability of pixel 767: 0.4170
Probability of pixel 768: 0.4185
Probability of pixel 769: 0.4204
Probability of pixel 770: 0.4222
Probability of pixel 771: 0.4240
Probability of pixel 772: 0.4250
Probability of pixel 773: 0.4267
Probability of pixel 774: 0.4289
Probability of pixel 775: 0.4275
Probability of pixel 776: 0.4289
Probability of pixel 777: 0.4302
Probability of pixel 778: 0.4288
Probability of pixel 779: 0.4302
Probability of pixel 780: 0.4317
Probability of pixel 781: 0.4331
Probability of pixel 782: 0.4316
Probability of pixel 783: 0.4332
Probability of pixel 784: 0.4317
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">new_image</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Class 0</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.image.AxesImage at 0x7fba0c5d6940&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_jose_mps_mnist_binarized_18_1.png" src="../_images/examples_jose_mps_mnist_binarized_18_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Class 1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.image.AxesImage at 0x7fba0c3019a0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_jose_mps_mnist_binarized_19_1.png" src="../_images/examples_jose_mps_mnist_binarized_19_1.png" />
</div>
</div>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="miles_mps_dmrg_mnist.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">MPS with DMRG - MNIST</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../api.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">API Reference</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By José Ramón Pareja Monturiol<br/>
  
      &copy; Copyright 2023, José Ramón Pareja Monturiol.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>